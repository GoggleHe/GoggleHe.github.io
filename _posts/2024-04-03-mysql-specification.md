---
layout: post
title: 数据库设计规范
categories: [MySQL]
description: 数据库设计规范
keywords: 数据库, 规范
---
转载于网络

本文档明确数据库设计原则和规范，规范数据库对象命名方式，见名知意，强化分工，保证数据库高效稳定运行

## 1 数据库设计原则

1) 充分考虑业务逻辑和数据分离，数据库只作为一个保证ACID特性的关系数据的持久化存储系统，尽量减少使用自定义函数、存储过程和视图，不用触发器。

2) 充分考虑数据库整体安全设计，数据库管理和使用人员权限分离。

3) 充分考虑具体数据对象的访问频度及性能需求，结合主机、存储等需求，做好数据库性能设计。

4) 充分考虑数据增长模型，决策是否采用“分布式（水平拆分或者垂直拆分）”模式。

5) 充分考虑业务数据安全等级，设计合适的备份和恢复策略。

## 2 设计规范

## 2.1 约定

1) 一般情况下设计遵守数据的设计规范3NF，尽量减少非标准范式或者反模式使用。

3NF规定：

Ø 表内的每一个值都只能被表达一次。

Ø 表内的每一行都应该被唯一的标识（有唯一键）。

Ø 表内不应该存储依赖于其他键的非键信息。

常见关键字（不得直接作为相关命名）：range、match、delayed、select、and、from、where、not、in、out、add、as、user、name、key、index、type、group、order、max、min、count、concat、by、desc、asc、null等等，更多请参考 MySQL 官方保留字。

2) 数据库和表的字符集统一：字符集（utf8mb4），排序规则（utf8mb4_general_ci）

## 2.2 表设计规范

1) 应该根据系统架构中的组件划分，针对每个组件所处理的业务进行组件单元的数据库设计；不同组件间所对应的数据库表之间的关联应尽可能减少，确保组件对应的表之间的独立性，为系统或表结构的重构提供可能性。

2) 采用领域模型驱动的方式和自顶向下的思路进行数据库设计，首先分析系统业务，根据职责定义对象。对象要符合封装的特性，确保与职责相关的数据项被定义在一个对象之内，不会出现职责描述缺失或多余。

3) 应针对所有表的主键和外键建立索引，有针对性地建立组合属性的索引。

4) 尽量少采用存储过程。

5) 设计出的表要具有较好的使用性。

6) 设计出的表要尽可能减少数据冗余，确保数据的准确性。

## 2.3 字段规范

1) 一行记录必须表内唯一，表必须有主键。

2) 如果数据库类型为MYSQL ，应尽量以自增INT类型为主键。如果数据库类型为ORACLE，建议使用UUID为主键。

3) 日期字段，如需要按照时间进行KEY分区或者子分区，则使用VARCHAR2类型存储，存储格式为：YYYYMMDD 。如若不需要以KEY形式作为分区列，则使用DATE或者DATETIME类型存储。不建议使用时间戳存储时间。

4) 字段名称和字段数据类型对应，如DATE命名字段，则存储时间精确到日，如TIME命名字段，则存储时间精确到时分秒，甚至毫秒。

## 2.4 命名规范类

### 2.4.1 约定

1) 数据库对象命名清晰，尽量做到见名知意，在进行数据库建模时备注对象，便于他人理解。

2) 数据库类型为MYSQL,采用全小写英文单词

3) 数据库类型为ORACLE，则使用驼峰式命名规范

4) 数据库对象命名长度不能超过30个字符

## 3 管理范围

管理数据库中所有对象，包括库，表，视图，索引，过程，自定义函数，包，序列，触发器等

## 3.1 建库

1) 数据库名：采用小写英文单词简拼或汉字小写拼音,多个单词或拼音采用下划线"_"连接

2) 数据库编码规则及排序规则：字符集（utf8mb4），排序规则（utf8mb4_general_ci）

3) 建库其他要求：库名与应用名称尽量一致

## 3.2 建表

表名应使用名词性质小写英文单词。如果需要单词词组来进行概括，单词与单词之间使用英文半角输入状态下_连接。如果超长，则从前面单词开始截取，保留单词前三位，保留完整的最后一个单词，如果依然超长，则保留前面单词首字母，直接和最后一个单词连接；临时表命名以TMP开头，命名格式为TMP_模块/用途名称_名字拼音首字母；表名不能直接采用关键字命名

1) 表命名：采用“业务名称_表的作用”格式命名（例如：alipay_task / force_project / trade_config）

2) 建表其他要求：表名长度不能超过30个字符；一定要指定一个主键字段；必须要根据业务对表注释；如果修改字段含义或对字段表示的状态追加时，需要及时更新字段注释；

3) 表必备字段：

`is_delete` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '状态（1删除、0未删除）',

`is_enabled` tinyint(1) unsigned NOT NULL DEFAULT '1' COMMENT '状态（1启用、0作废）',

`op_first` varchar(50) DEFAULT NULL COMMENT '创建人',

`op_first_time` datetime DEFAULT NULL COMMENT '创建时间',

`op_last` varchar(50) DEFAULT NULL COMMENT '更新人',

`op_last_time` datetime DEFAULT NULL COMMENT '更新时间',

## 3.3 建字段

1) 字段命名：

表中标识唯一性字段必须以标识性简称+id命名。其余字段根据存储信息，使用名词性质英文单词表示，如需要单词词组来进行概括，单词与单词之间使用英文半角输入状态下_连接。外键引用字段使用外键表_id的形式命名；字段名必须使用小写字母或数字，禁止出现数字开头，禁止两个下划线中间只出现数字；表达是与否概念的字段，必须使用 is_xxx 的方式命名，数据类型是 unsigned tinyint；表达逻辑删除的字段名 is_deleted，1 表示删除，0 表示未删除

2) 字段类型、长度

如果存储的字符串长度几乎相等，使用 char 定长字符串类型；小数类型为 decimal；id 必为主键，类型为 bigint unsigned；应尽量以自增INT类型为主键；优先选择符合存储需要的最小的数据类型；将字符串转化为数字类型存储；对于非负数据采用无符号整形进行存储signed int -2147483648-2147483648，unsigned int 0-2147483648，有符号比无符号多出一倍的存储空间；varchar(n) n代表字符数，不是字节数，varchar(255)=765个字节，过大的长度会消耗更多的内存；避免使用text\BLOB数据类型，建议text\BLOB列分离到单独的扩展表中，text\BLOB类型只能使用前缀索引；避免使用enum数据类型，修改enum需要使用alter语句，enum类型的order by操作效率低，需要额外操作，禁止使用数值作为enum的枚举值；尽可能把所有列定义为not null，索引null列需要额外的空间来保存，所以要占用更多的空间，进行比较和计算时要对null值做特别的处理；禁止字符串存储日期型的数据，缺点1：无法用日期函数进行计算和比较，缺点2：用字符串存储日期要占用更多的空间；使用timestamp或datetime类型存储时间，timestamp存储空间更小；财务的相关金额使用decimal类型，decimal类型为精准浮点数，在计算时不会丢失精度，float、double非精准浮点数

3) 字段其他要求

字段名称长度不能超过30个字符、尽量减少或者不使用联合主键、字段尽可能不允许为null(为null时设定默认值)、文本类型字段，属性 字符集（utf8mb4），排序规则（utf8mb4_general_ci）、字段必须根据业务进行注释。

## 3.4 建索引

主键索引名为 pk_字段名；唯一索引名为 uk_字段名；普通索引名则为 idx_字段名。

说明：pk_ 即 primary key；uk_ 即 unique key；idx_ 即 index 的简称。

## 3.5 创建数据库表视图

1) 视图命名：以"v_项目名/模块名_用途"格式命名

2) 视图其他要求：视图名称长度不能超过30个字符

## 3.6 建存储过程及自定义数据库函数

1) 存储过程命名：以"sp_用途"格式命名

2) 自定义数据库函数：以“fn_用途”格式命名

3) 存储过程或自定义数据库函数：参数命名以“p_”开头命名；内部变量命名以“v_”开头命名；游标命名以“cur_loop_”开头命名；循环变量命名以“i_found_”开头命名。

## 3.7 建数据库用户

用户命名：采用授权用户姓名全拼小写命名

## 3.8 其他要求

1) 查询大数据表，参数字段需建索引；

2) 数据库表、字段删除或变更操作（a-不需要的表或字段，一般备注“作废”即可;b-需要修改的表或字段，先备注作废原表或原字段，再创建新表或新字段，且备注好作废原因。）；